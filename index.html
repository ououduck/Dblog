<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dçš„æ—¥è®°</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>

<header>
    <div class="header-content">
        <img src="/image/header.png" alt="header" class="header">
        <h1>Dçš„æ—¥è®°</h1>
        <p>Då·¥ä½œå®¤çš„ä¸»ç«™ç‚¹</p>
    </div>
</header>

<nav>
    <ul>
        <li><a href="/index.html" onclick="router(event)">ğŸ“ é¦–é¡µ</a></li>
        <li><a href="/subsites.html" onclick="router(event)">ğŸŒ æ——ä¸‹ç«™ç‚¹</a></li>
        <li><a href="/link.html" onclick="router(event)">ğŸ”— å‹é“¾</a></li>
        <li><a href="/contact.html" onclick="router(event)">ğŸ“® è”ç³»</a></li>
        <li><a href="/about.html" onclick="router(event)">â„¹ï¸ å…³äº</a></li>
    </ul>
</nav>

<main>
    <section>
        <select id="category-filter" onchange="filterPosts()">
            <option value="">æ‰€æœ‰åˆ†ç±»</option>
            <option value="æ—¥è®°">æ—¥è®°</option>
            <option value="æ•™ç¨‹">æ•™ç¨‹</option>
            <option value="åˆ†äº«">åˆ†äº«</option>
        </select>
    </section>
    <section class="post-list">
        <h2>æ–‡ç« åˆ—è¡¨</h2>
    </section>
    <div class="pagination">
        <button id="prev-page" onclick="changePage(-1)">ä¸Šä¸€é¡µ</button>
        <span id="page-info"></span>
        <button id="next-page" onclick="changePage(1)">ä¸‹ä¸€é¡µ</button>
    </div>
</main>

<footer>
    <p>&copy; 2025 Då·¥ä½œå®¤&duck. All rights reserved.</p>
    <p><a href="https://beian.miit.gov.cn" target="_blank">æ¹˜ICPå¤‡2025101669å·-1</a></p>
    <p><a href="https://github.com/ououduck/Dblog" target="_blank">GitHubå·²å¼€æº</a></p>
    <button class="theme-toggle" onclick="toggleTheme()">åˆ‡æ¢ä¸»é¢˜</button>
</footer>

<script>
    let currentPage = 1;
    const postsPerPage = 5;

    async function loadPosts() {
        try {
            const response = await fetch("posts.json");
            if (!response.ok) {
                throw new Error("Failed to fetch posts");
            }
            const posts = await response.json();
            window.posts = posts;
            displayPosts();
        } catch (error) {
            console.error("Error loading posts:", error);
            document.querySelector(".post-list").innerHTML = "<p>åŠ è½½æ–‡ç« åˆ—è¡¨æ—¶å‘ç”Ÿé”™è¯¯</p>";
        }
    }

    function displayPosts() {
        const postList = document.querySelector(".post-list");
        postList.innerHTML = "<h2>æ–‡ç« åˆ—è¡¨</h2>";

        const start = (currentPage - 1) * postsPerPage;
        const end = start + postsPerPage;
        const paginatedPosts = window.posts.slice(start, end);

        paginatedPosts.forEach(post => {
            const postElement = document.createElement("article");
            postElement.className = "post";
            const img = new Image();
            img.src = post.cover;
            img.alt = `${post.title} å°é¢`;
            img.className = "cover";
            img.onerror = () => {
                img.src = "/image/post-cover/default-cover.jpg"; // é»˜è®¤å°é¢å›¾ç‰‡è·¯å¾„
            };
            postElement.appendChild(img);
            const postContent = document.createElement("div");
            postContent.className = "post-content";
            postContent.innerHTML = `
                <h3><a href="${post.url}" onclick="router(event)">${post.title}</a></h3>
                <p>${post.content}</p>
                <p>å‘å¸ƒäº ${post.time}</p>
            `;
            postElement.appendChild(postContent);
            postList.appendChild(postElement);
        });

        updatePagination();
    }

    function updatePagination() {
        const pageInfo = document.getElementById("page-info");
        const totalPages = Math.ceil(window.posts.length / postsPerPage);
        pageInfo.textContent = `ç¬¬ ${currentPage} é¡µï¼Œå…± ${totalPages} é¡µ`;

        document.getElementById("prev-page").disabled = currentPage === 1;
        document.getElementById("next-page").disabled = currentPage === totalPages;
    }

    function changePage(direction) {
        currentPage += direction;
        displayPosts();
    }

    function filterPosts() {
        const selectedCategory = document.getElementById("category-filter").value;
        window.posts = window.posts.filter(post => !selectedCategory || post.category === selectedCategory);
        currentPage = 1;
        displayPosts();
    }

    document.addEventListener("DOMContentLoaded", () => {
        document.body.classList.add("loaded");
        loadPosts();
        applyTheme();
    });

    async function router(event) {
        event.preventDefault();
        const url = event.target.href;
        const response = await fetch(url);
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const newContent = doc.querySelector('main').innerHTML;
        document.querySelector('main').innerHTML = newContent;
        window.history.pushState({}, '', url);

        // é‡æ–°åŠ è½½æ–‡ç« åˆ—è¡¨
        loadPosts();
    }

    window.addEventListener('popstate', async () => {
        const response = await fetch(window.location.href);
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        document.querySelector('main').innerHTML = doc.querySelector('main').innerHTML;
        loadMusicPlayer();
    });

    function loadMusicPlayer() {
        // å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ¢å¤éŸ³ä¹æ’­æ”¾å™¨çš„çŠ¶æ€
        // ä¾‹å¦‚ï¼Œä» sessionStorage æˆ– localStorage ä¸­è¯»å–æ’­æ”¾è¿›åº¦
    }

    function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        document.documentElement.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
    }

    function applyTheme() {
        const savedTheme = localStorage.getItem("theme") || "light";
        document.documentElement.setAttribute("data-theme", savedTheme);
    }
</script>

<!-- å¼•å…¥å°æ«æ’­æ”¾å™¨ -->
<script src="/xf-MusicPlayer/js/xf-MusicPlayer.min.js"></script>          
 <!-- é…ç½®å°æ«æ’­æ”¾å™¨ -->
<!--  è¿™æ˜¯æœ¬åœ°ç‰ˆ <div id="xf-MusicPlayer"  data-localMusic="playData.json"></div>-->
<!--<div id="xf-MusicPlayer"  data-songList="26467411"></div>æ­Œå•ç‰ˆ-->
<div id="xf-MusicPlayer"  data-randomSongList="1" data-fadeOutAutoplay data-themeColor="xf-sky" data-random="true" data-memory="1"></div><!--æ¦œå•ç‰ˆ-->

</body>
</html>